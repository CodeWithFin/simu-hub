"use strict";(()=>{var e={};e.id=573,e.ids=[573],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4018:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>h,patchFetch:()=>m,requestAsyncStorage:()=>p,routeModule:()=>u,serverHooks:()=>g,staticGenerationAsyncStorage:()=>I});var a={};t.r(a),t.d(a,{GET:()=>l,POST:()=>d});var s=t(9303),i=t(8716),n=t(670),o=t(7070),c=t(9145);async function d(e){try{let{orderId:r,overallRating:t,productRating:a,deliveryRating:s,comments:i,wouldRecommend:n}=await e.json(),{data:d,error:l}=await c.O.from("orders").select("id").eq("id",r).single();if(l||!d)return o.NextResponse.json({success:!1,error:"Order not found"},{status:404});let{data:u}=await c.O.from("feedback").select("id").eq("order_id",r).single();if(u)return o.NextResponse.json({success:!1,error:"Feedback already submitted for this order"},{status:400});let{data:p,error:I}=await c.O.from("feedback").insert({order_id:r,overall_rating:t,product_rating:a,delivery_rating:s,comments:i,would_recommend:n}).select().single();if(I)throw I;return o.NextResponse.json({success:!0,data:p},{status:201})}catch(e){return o.NextResponse.json({success:!1,error:e.message},{status:500})}}async function l(e){try{let r=e.nextUrl.searchParams,t=r.get("rating"),a=r.get("startDate"),s=r.get("endDate"),i=c.O.from("feedback").select(`
        *,
        orders:order_id (
          id,
          order_reference,
          created_at,
          products:product_id (brand, model)
        )
      `).order("created_at",{ascending:!1});t&&(i=i.gte("overall_rating",parseInt(t))),a&&(i=i.gte("created_at",a)),s&&(i=i.lte("created_at",s));let{data:n,error:d}=await i;if(d)throw d;let l=n&&n.length>0?n.reduce((e,r)=>e+(r.overall_rating||0),0)/n.length:0,u=n&&n.length>0?n.reduce((e,r)=>e+(r.product_rating||0),0)/n.length:0,p=n&&n.length>0?n.reduce((e,r)=>e+(r.delivery_rating||0),0)/n.length:0;return o.NextResponse.json({success:!0,data:n,averages:{overall:l.toFixed(2),product:u.toFixed(2),delivery:p.toFixed(2)}})}catch(e){return o.NextResponse.json({success:!1,error:e.message},{status:500})}}let u=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/feedback/route",pathname:"/api/feedback",filename:"route",bundlePath:"app/api/feedback/route"},resolvedPagePath:"/home/finley/Finley-personal /simu-hub/app/api/feedback/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:p,staticGenerationAsyncStorage:I,serverHooks:g}=u,h="/api/feedback/route";function m(){return(0,n.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:I})}},9145:(e,r,t)=>{t.d(r,{O:()=>i});var a=t(7857);let s=null,i=function(){if(s)return s;try{let e="https://moxqcjveracxuthydide.supabase.co",r="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1veHFjanZlcmFjeHV0aHlkaWRlIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2ODQzODYzNSwiZXhwIjoyMDg0MDE0NjM1fQ.8lLOdRN8EfNC21Kj5a3RtGfICCCPYi4ZbkFbvDcDqEg";if(!e||!r)return console.warn("⚠️  Supabase environment variables not set. API calls will fail."),s=(0,a.eI)("https://placeholder.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0");return s=(0,a.eI)(e,r)}catch(e){return console.error("Error creating Supabase client:",e),s=(0,a.eI)("https://placeholder.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0")}}()}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[276,564],()=>t(4018));module.exports=a})();