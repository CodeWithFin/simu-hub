"use strict";(()=>{var e={};e.id=55,e.ids=[55],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5965:(e,s,r)=>{r.r(s),r.d(s,{originalPathname:()=>m,patchFetch:()=>g,requestAsyncStorage:()=>p,routeModule:()=>u,serverHooks:()=>I,staticGenerationAsyncStorage:()=>S});var o={};r.r(o),r.d(o,{PATCH:()=>d});var t=r(9303),i=r(8716),n=r(670),a=r(7070),c=r(9145),l=r(5423);async function d(e,{params:s}){try{let{id:r}=s,{status:o}=await e.json();if(!["pending","dispatched","ready","completed","cancelled"].includes(o))return a.NextResponse.json({success:!1,error:"Invalid status"},{status:400});let{data:t,error:i}=await c.O.from("orders").select(`
        *,
        customers:customer_id (*),
        products:product_id (*)
      `).eq("id",r).single();if(i||!t)return a.NextResponse.json({success:!1,error:"Order not found"},{status:404});let n={status:o};"dispatched"===o&&(n.dispatched_at=new Date().toISOString()),"completed"===o&&(n.completed_at=new Date().toISOString());let{data:d,error:u}=await c.O.from("orders").update(n).eq("id",r).select().single();if(u)throw u;let p=t.customers,S=t.products;if("dispatched"===o&&"doorstep"===t.delivery_method){let e=`Your order #${t.order_reference} has been dispatched!
${S.brand} ${S.model}
Expected delivery: Within 24 hours
Contact: ${process.env.SHOP_PHONE||"N/A"}`;await (0,l.X)(p.phone,e,t.id)}if("ready"===o&&"pickup"===t.delivery_method){let e=`Your order #${t.order_reference} is ready for pickup!
${S.brand} ${S.model}
Pickup at: ${process.env.SHOP_ADDRESS||"Store"}
Hours: ${process.env.SHOP_HOURS||"Mon-Sat: 9AM-6PM"}
Bring: Order ID and valid ID
Contact: ${process.env.SHOP_PHONE||"N/A"}`;await (0,l.X)(p.phone,e,t.id)}if("completed"===o){let e=`Thank you for your purchase from ${process.env.SHOP_NAME||"Simu Hub"}!
How was your experience with ${S.brand} ${S.model}?
Share your feedback: https://simu-hub.vercel.app/feedback
Your opinion helps us improve!`;console.log("Sending feedback request SMS to customer:",p.phone);let s=await (0,l.X)(p.phone,e,t.id);console.log("Feedback request SMS result:",s),s.success||console.error("Failed to send feedback request SMS:",s.error)}return a.NextResponse.json({success:!0,data:d})}catch(e){return a.NextResponse.json({success:!1,error:e.message},{status:500})}}let u=new t.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/orders/[id]/status/route",pathname:"/api/orders/[id]/status",filename:"route",bundlePath:"app/api/orders/[id]/status/route"},resolvedPagePath:"/home/finley/Finley-personal /simu-hub/app/api/orders/[id]/status/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:p,staticGenerationAsyncStorage:S,serverHooks:I}=u,m="/api/orders/[id]/status/route";function g(){return(0,n.patchFetch)({serverHooks:I,staticGenerationAsyncStorage:S})}},5423:(e,s,r)=>{r.d(s,{X:()=>t});var o=r(9145);let t=async(e,s,r)=>{try{let t=process.env.SMS_ENDPOINT||process.env.TILIL_SMS_URL||"https://api.tililtech.com/sms/v3/sendsms",i=process.env.TILIL_API_KEY,n=process.env.TILIL_SHORTCODE||process.env.TILIL_SENDER_ID||"SIMUHUB";if(!i)return console.warn("Tilil API key not configured. SMS not sent."),console.warn("Required: TILIL_API_KEY"),{success:!1,error:"SMS service not configured"};let a=e.replace(/\s+/g,"").replace(/^\+/,"");console.log("Sending SMS via Tilil to:",a),console.log("Using endpoint:",t),console.log("Using shortcode:",n);let c={api_key:i,service:0,mobile:a,response_type:"json",shortcode:n,message:s};console.log("Tilil SMS Request:",JSON.stringify({...c,api_key:`${i.substring(0,10)}...`,message:`${s.substring(0,50)}...`},null,2));let l=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)}),d=await l.json();console.log("Tilil SMS response status:",l.status),console.log("Tilil SMS response:",JSON.stringify(d,null,2));let u=Array.isArray(d)?d[0]:d;if(u&&u.status_code&&"1000"!==u.status_code&&"1"!==u.status_code&&1e3!==u.status_code&&1!==u.status_code){let t=u.status_desc||"SMS sending failed";return console.error("❌ Tilil SMS error:",t),console.error("Status code:",u.status_code),console.error("Full response:",u),"1001"===u.status_code?(console.error("⚠️  SENDER ID ERROR: The shortcode/sender ID is not registered with Tilil"),console.error("\uD83D\uDCA1 Solution: Log into your Tilil dashboard and verify your approved sender IDs"),console.error("Current shortcode:",n)):"1006"===u.status_code||"1013"===u.status_code?(console.error("⚠️  API KEY ERROR: The API key is invalid or expired"),console.error("\uD83D\uDCA1 Solution: Verify your TILIL_API_KEY in .env.local")):"1003"===u.status_code?(console.error("⚠️  PHONE NUMBER ERROR: Invalid mobile number format"),console.error("Current number:",a)):"1004"===u.status_code&&(console.error("⚠️  CREDIT ERROR: Insufficient SMS credits"),console.error("\uD83D\uDCA1 Solution: Top up your Tilil account")),r&&await o.O.from("sms_logs").insert({order_id:r,recipient_phone:e,message_type:"notification",message_content:s,status:"failed",response:JSON.stringify(d)}),{success:!1,error:t}}if(!l.ok)return console.error("❌ Tilil SMS HTTP error:",d),r&&await o.O.from("sms_logs").insert({order_id:r,recipient_phone:e,message_type:"notification",message_content:s,status:"failed",response:JSON.stringify(d)}),{success:!1,error:d.message||"SMS sending failed"};return console.log("✅ SMS sent successfully!"),console.log("Message ID:",u.message_id),console.log("Credit balance:",u.credit_balance),r&&await o.O.from("sms_logs").insert({order_id:r,recipient_phone:e,message_type:"notification",message_content:s,status:"sent",sent_at:new Date().toISOString(),response:JSON.stringify(d)}),{success:!0,data:d}}catch(t){return console.error("❌ SMS sending exception:",t),r&&await o.O.from("sms_logs").insert({order_id:r,recipient_phone:e,message_type:"notification",message_content:s,status:"failed",response:JSON.stringify({error:t.message})}),{success:!1,error:t.message}}}},9145:(e,s,r)=>{r.d(s,{O:()=>i});var o=r(7857);let t=null,i=function(){if(t)return t;try{let e="https://moxqcjveracxuthydide.supabase.co",s="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1veHFjanZlcmFjeHV0aHlkaWRlIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2ODQzODYzNSwiZXhwIjoyMDg0MDE0NjM1fQ.8lLOdRN8EfNC21Kj5a3RtGfICCCPYi4ZbkFbvDcDqEg";if(!e||!s)return console.warn("⚠️  Supabase environment variables not set. API calls will fail."),t=(0,o.eI)("https://placeholder.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0");return t=(0,o.eI)(e,s)}catch(e){return console.error("Error creating Supabase client:",e),t=(0,o.eI)("https://placeholder.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0")}}()}};var s=require("../../../../../webpack-runtime.js");s.C(e);var r=e=>s(s.s=e),o=s.X(0,[276,564],()=>r(5965));module.exports=o})();