"use strict";(()=>{var e={};e.id=512,e.ids=[512],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3072:(e,s,r)=>{r.r(s),r.d(s,{originalPathname:()=>S,patchFetch:()=>g,requestAsyncStorage:()=>d,routeModule:()=>u,serverHooks:()=>I,staticGenerationAsyncStorage:()=>p});var o={};r.r(o),r.d(o,{POST:()=>l});var t=r(9303),n=r(8716),i=r(670),a=r(7070),c=r(5423);async function l(e){try{let{phone:s,message:r}=await e.json();if(!s||!r)return a.NextResponse.json({success:!1,error:"Phone and message required"},{status:400});console.log("Testing SMS to:",s);let o=await (0,c.X)(s,r);return a.NextResponse.json({success:o.success,data:o.data,error:o.error})}catch(e){return console.error("Test SMS error:",e),a.NextResponse.json({success:!1,error:e.message},{status:500})}}let u=new t.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/test-sms/route",pathname:"/api/test-sms",filename:"route",bundlePath:"app/api/test-sms/route"},resolvedPagePath:"/home/finley/Finley-personal /simu-hub/app/api/test-sms/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:d,staticGenerationAsyncStorage:p,serverHooks:I}=u,S="/api/test-sms/route";function g(){return(0,i.patchFetch)({serverHooks:I,staticGenerationAsyncStorage:p})}},5423:(e,s,r)=>{r.d(s,{X:()=>t});var o=r(9145);let t=async(e,s,r)=>{try{let t=process.env.SMS_ENDPOINT||process.env.TILIL_SMS_URL||"https://api.tililtech.com/sms/v3/sendsms",n=process.env.TILIL_API_KEY,i=process.env.TILIL_SHORTCODE||process.env.TILIL_SENDER_ID||"SIMUHUB";if(!n)return console.warn("Tilil API key not configured. SMS not sent."),console.warn("Required: TILIL_API_KEY"),{success:!1,error:"SMS service not configured"};let a=e.replace(/\s+/g,"").replace(/^\+/,"");console.log("Sending SMS via Tilil to:",a),console.log("Using endpoint:",t),console.log("Using shortcode:",i);let c={api_key:n,service:0,mobile:a,response_type:"json",shortcode:i,message:s};console.log("Tilil SMS Request:",JSON.stringify({...c,api_key:`${n.substring(0,10)}...`,message:`${s.substring(0,50)}...`},null,2));let l=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)}),u=await l.json();console.log("Tilil SMS response status:",l.status),console.log("Tilil SMS response:",JSON.stringify(u,null,2));let d=Array.isArray(u)?u[0]:u;if(d&&d.status_code&&"1000"!==d.status_code&&"1"!==d.status_code&&1e3!==d.status_code&&1!==d.status_code){let t=d.status_desc||"SMS sending failed";return console.error("❌ Tilil SMS error:",t),console.error("Status code:",d.status_code),console.error("Full response:",d),"1001"===d.status_code?(console.error("⚠️  SENDER ID ERROR: The shortcode/sender ID is not registered with Tilil"),console.error("\uD83D\uDCA1 Solution: Log into your Tilil dashboard and verify your approved sender IDs"),console.error("Current shortcode:",i)):"1006"===d.status_code||"1013"===d.status_code?(console.error("⚠️  API KEY ERROR: The API key is invalid or expired"),console.error("\uD83D\uDCA1 Solution: Verify your TILIL_API_KEY in .env.local")):"1003"===d.status_code?(console.error("⚠️  PHONE NUMBER ERROR: Invalid mobile number format"),console.error("Current number:",a)):"1004"===d.status_code&&(console.error("⚠️  CREDIT ERROR: Insufficient SMS credits"),console.error("\uD83D\uDCA1 Solution: Top up your Tilil account")),r&&await o.O.from("sms_logs").insert({order_id:r,recipient_phone:e,message_type:"notification",message_content:s,status:"failed",response:JSON.stringify(u)}),{success:!1,error:t}}if(!l.ok)return console.error("❌ Tilil SMS HTTP error:",u),r&&await o.O.from("sms_logs").insert({order_id:r,recipient_phone:e,message_type:"notification",message_content:s,status:"failed",response:JSON.stringify(u)}),{success:!1,error:u.message||"SMS sending failed"};return console.log("✅ SMS sent successfully!"),console.log("Message ID:",d.message_id),console.log("Credit balance:",d.credit_balance),r&&await o.O.from("sms_logs").insert({order_id:r,recipient_phone:e,message_type:"notification",message_content:s,status:"sent",sent_at:new Date().toISOString(),response:JSON.stringify(u)}),{success:!0,data:u}}catch(t){return console.error("❌ SMS sending exception:",t),r&&await o.O.from("sms_logs").insert({order_id:r,recipient_phone:e,message_type:"notification",message_content:s,status:"failed",response:JSON.stringify({error:t.message})}),{success:!1,error:t.message}}}},9145:(e,s,r)=>{r.d(s,{O:()=>n});var o=r(7857);let t=null,n=function(){if(t)return t;try{let e="https://moxqcjveracxuthydide.supabase.co",s="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1veHFjanZlcmFjeHV0aHlkaWRlIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2ODQzODYzNSwiZXhwIjoyMDg0MDE0NjM1fQ.8lLOdRN8EfNC21Kj5a3RtGfICCCPYi4ZbkFbvDcDqEg";if(!e||!s)return console.warn("⚠️  Supabase environment variables not set. API calls will fail."),t=(0,o.eI)("https://placeholder.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0");return t=(0,o.eI)(e,s)}catch(e){return console.error("Error creating Supabase client:",e),t=(0,o.eI)("https://placeholder.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0")}}()}};var s=require("../../../webpack-runtime.js");s.C(e);var r=e=>s(s.s=e),o=s.X(0,[276,564],()=>r(3072));module.exports=o})();